# 日田市観光最適化ルートナビ

日田市の観光スポットを効率的に回るための最適ルート計算・ナビゲーションWebアプリです。

## 🌟 主な機能

1. **観光スポット選択**: 複数の観光スポットから訪問したい場所を選択
2. **最適ルート計算**: ヒュベニの公式と独自アルゴリズムによる最適ルート算出
3. **位置情報取得**: ユーザーの現在位置を起点とした効率的なルート提案
4. **インタラクティブマップ**: Foliumを使用した見やすい地図表示
5. **ナビゲーション**: Google Mapsとの連携による実際のナビゲーション

## 📋 必要な環境

- Python 3.8以上
- インターネット接続（地図表示・位置情報取得）
- モダンブラウザ（Chrome, Firefox, Safari等）

## 🛠️ セットアップ手順

### 1. 必要なライブラリのインストール

```bash
pip install -r requirements.txt
```

### 2. 観光スポットデータの準備

観光スポットデータ用のExcelファイルを作成：

```bash
python excel_data_sample.py
```

これにより `hita_tourism_spots.xlsx` ファイルが作成されます。

### 3. アプリケーションの実行

```bash
streamlit run app.py
```

ブラウザで `http://localhost:8501` にアクセスしてアプリを使用できます。

## 📁 ファイル構成

```
.
├── app.py                      # メインアプリケーション
├── route_optimizer.py          # ルート最適化アルゴリズム
├── geolocation.py             # 位置情報取得モジュール
├── excel_data_sample.py       # サンプルデータ作成スクリプト
├── requirements.txt           # 必要ライブラリ一覧
├── hita_tourism_spots.xlsx    # 観光スポットデータ（自動生成）
└── README.md                  # このファイル
```

## 🎯 使用方法

### 1. 基本的な使い方

1. アプリを起動
2. サイドバーで「現在位置を取得」ボタンをクリック（オプション）
3. 「観光スポット選択」で訪問したいスポットを複数選択
4. 自動的に最適ルートが計算され、地図に表示されます
5. 「ルートナビを開始」でGoogle Mapsでのナビゲーションが可能

### 2. 観光スポットデータの管理

`hita_tourism_spots.xlsx` ファイルを編集することで、新しいスポットの追加や既存スポット情報の更新が可能です。

**必要な列：**
- `スポット名`: 観光スポットの名称
- `緯度`: 緯度座標（度）
- `経度`: 経度座標（度）
- `最低所要時間`: 滞在時間（分）
- `おすすめ度`: 1-5の評価
- `説明`: スポットの説明文

## 🔧 最適化アルゴリズム

### 距離計算
ヒュベニの公式を使用して2地点間の正確な距離を計算：

```
distance = √((Dy × M)² + (Dx × N × cos P)²)
```

### ルート最適化
各スポットのスコアを以下の式で計算：

```
Si = RW,i + RD,i
```

- `RW,i`: スポットiの所要時間減少率ランキング
- `RD,i`: スポットiの他スポットまでの距離ランキング
- `Si`: スポットiの合計スコア（最小値を次のスポットとして選択）

## 📱 位置情報機能

ブラウザのGeolocation APIを使用してユーザーの現在位置を取得。位置情報を利用することで、より効率的な出発点からのルート計算が可能です。

### プライバシーについて
- 位置情報はローカルでのみ使用
- 外部サーバーへの送信は行いません
- ユーザーの許可なしに位置情報は取得しません

## 🗺️ 地図機能

- **Folium**: インタラクティブな地図表示
- **マーカー**: 各観光スポットの位置表示
- **ルート表示**: 最適化されたルートを線で表示
- **ポップアップ**: スポット詳細情報の表示

## ⚡ パフォーマンス最適化

- データキャッシュ機能でExcelファイルの読み込み高速化
- 効率的な距離計算アルゴリズム
- レスポンシブデザインによる様々なデバイス対応

## 🔍 トラブルシューティング

### よくある問題と解決方法

1. **位置情報が取得できない**
   - ブラウザで位置情報の許可を確認
   - HTTPSでのアクセスを推奨

2. **地図が表示されない**
   - インターネット接続を確認
   - ブラウザのJavaScriptが有効か確認

3. **Excelファイルが読み込めない**
   - ファイルパスと列名を確認
   - openpyxlライブラリがインストールされているか確認

## 🔄 カスタマイズ

### 新しい地域への対応
1. 対象地域の観光スポットデータを準備
2. `excel_data_sample.py`を参考にExcelファイルを作成
3. 地図の中心座標を調整

### アルゴリズムの調整
`route_optimizer.py`の重み付けパラメータを調整することで、距離重視や時間効率重視など、異なる最適化戦略を実装可能です。

## 📞 サポート

問題や改善提案がございましたら、お気軽にお知らせください。

---

## 🏗️ 技術仕様

- **フレームワーク**: Streamlit
- **地図ライブラリ**: Folium
- **データ処理**: Pandas, NumPy
- **距離計算**: ヒュベニの公式（高精度）
- **位置情報**: HTML5 Geolocation API

このアプリケーションは日田市の観光振興と訪問者の利便性向上を目的として開発されました。